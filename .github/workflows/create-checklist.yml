name: Criar checklist inicial

on:
  push:
    branches:
      - main

jobs:
  create-checklist:
    runs-on: ubuntu-latest
    steps:
      - name: Criar issue se nÃ£o existir
        uses: actions/github-script@v7
        with:
          script: |
            const repoOwner = context.repo.owner;
            const repoName = context.repo.repo;
            const issueTitle = '[Checklist] ' + repoName;

            const openIssues = await github.rest.issues.listForRepo({
              owner: repoOwner,
              repo: repoName,
              state: 'open',
              per_page: 100
            });

            const alreadyExists = openIssues.data.some(issue => issue.title === issueTitle);
            if (alreadyExists) {
              console.log("Checklist jÃ¡ existe.");
              return;
            }

            const bodyLines = [
              '### ğŸ“¦ Checklist de Entrega',
              '',
              'Antes de publicar o site, complete todos os itens abaixo.',
              '',
              '#### ğŸ“„ ConteÃºdo e SEO',
              '- [ ] `<title>` configurado corretamente em todas as pÃ¡ginas',
              '- [ ] Meta description preenchida',
              '- [ ] Open Graph e Twitter Cards configurados',
              '- [ ] Imagem de compartilhamento definida e testada',
              '- [ ] Favicon e Ã­cones configurados',
              '- [ ] `sitemap.xml` presente e atualizado',
              '',
              '#### âš™ï¸ Funcionalidade',
              '- [ ] Links internos e externos testados',
              '- [ ] FormulÃ¡rios validados e com envio funcional',
              '- [ ] Scripts de analytics inseridos corretamente',
              '- [ ] Responsividade testada',
              '',
              '#### ğŸš€ Performance e SeguranÃ§a',
              '- [ ] Imagens otimizadas',
              '- [ ] CSS e JS minificados',
              '- [ ] Sem erros no console do navegador',
              '',
              '#### ğŸ“¦ Deploy e Backup',
              '- [ ] Build final gerada e revisada',
              '- [ ] Deploy testado',
              '- [ ] VersÃ£o final aprovada pelo cliente',
              '',
              '#### âœï¸ ObservaÃ§Ãµes Finais',
              '_Aguardando preenchimento manual._'
            ];

            const issueBody = bodyLines.join('\n');

            await github.rest.issues.create({
              owner: repoOwner,
              repo: repoName,
              title: issueTitle,
              labels: ['checklist', 'entrega'],
              body: issueBody
            });
